{% extends 'base.html' %}
{% load static %}
{% load blog_tags %}

{% block content %}
    <!-- =================== POST DETAIL =================== -->
    <section class="main-content">
        <div class="container">
            <div class="content-grid">
                <div>
                    <!-- Breadcrumb -->
                    <div class="detail-header">
                        <div class="detail-breadcrumb">
                            <a href="{% url 'index' %}">Ø®Ø§Ù†Ù‡</a> / <a
                                href="{% url 'index' %}?cat={{ post.category.name }}"
                                id="detailCatLink">{{ post.category.name }}</a> / <span
                                id="detailBreadTitle">{{ post.user.full_name }}</span>
                        </div>
                        <h1 id="detailTitle">{{ post.title }}</h1>
                        <div class="detail-meta">
                            <div class="author-info">
                                <img src="{{ post.user.image.url }}"
                                     alt="{{ post.title }}">
                                <div>
                                    <strong id="detailAuthor">{{ post.user.full_name }}</strong>
                                    <div id="detailDate"
                                         style="font-size:12px; color:var(--text-lighter);">{{ post.published_at }}</div>
                                </div>
                            </div>
                            <span>â± <span id="detailReadTime">{{ post.estimated_reading_time|persian_int }}</span> Ø¯Ù‚ÛŒÙ‚Ù‡ Ù…Ø·Ø§Ù„Ø¹Ù‡</span>
                            <span>ğŸ‘ <span id="detailViews">{{ post.view_count|persian_int }}</span> Ø¨Ø§Ø²Ø¯ÛŒØ¯</span>
                            <span>ğŸ’¬ <span id="detailCommentCount">Ûµ</span> Ù†Ø¸Ø±</span>
                        </div>
                    </div>

                    <!-- Cover -->
                    <img class="detail-cover" id="detailCover" src="{{ post.image.url }}" alt="{{ post.title }}">

                    <!-- Short URL -->
                    <div class="short-url-section">
                        <div class="url-label">ğŸ”— Ù„ÛŒÙ†Ú© Ú©ÙˆØªØ§Ù‡:</div>
                        <div class="url-input-group">
                            <input type="text" id="shortUrlInput"
                                   value="{% absolute_url 'redirect-to-real-url' short_code=post.short_code %}"
                                   readonly>
                            <button onclick="copyShortUrl()">ğŸ“‹ Ú©Ù¾ÛŒ</button>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="detail-content" id="detailContent">{{ post.content|safe }}</div>

                    <!-- Tags -->
                    <div class="detail-tags" id="detailTags"><span>ğŸ·ï¸ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§:</span>
                        {% for tag in post.tags.all %}
                            <a href="{% url 'index' %}?tag={{ tag.name }}"
                               class="post-tag">#{{ tag.name }}</a>
                        {% endfor %}
                    </div>

                    <!-- Share -->
                    <div class="detail-share">
                        <span>Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ:</span>
                        <a href="https://twitter.com/share?text={{ post.title }}&url={% absolute_url 'redirect-to-real-url' short_code=post.short_code %}"
                           target="_blank">
                            <button class="share-btn" title="ØªÙˆÛŒÛŒØªØ±">ğ•</button>
                        </a>
                        <a href="https://telegram.me/share/?url={% absolute_url 'redirect-to-real-url' short_code=post.short_code %}"
                           target="_blank">
                            <button class="share-btn" title="ØªÙ„Ú¯Ø±Ø§Ù…">âœˆï¸</button>
                        </a>
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url={% absolute_url 'redirect-to-real-url' short_code=post.short_code %}"
                           target="_blank">
                            <button class="share-btn" title="Ù„ÛŒÙ†Ú©Ø¯ÛŒÙ†">in</button>
                        </a>
                        <button class="share-btn" title="Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©" onclick="copyShortUrl()">ğŸ”—</button>
                    </div>

                    <!-- Author Box -->
                    <div class="author-box">
                        <img src="{{ post.user.image.url }}"
                             alt="{{ post.user.full_name }}">
                        <div>
                            <h4 id="authorBoxName">{{ post.user.full_name }}</h4>
                            <p>{{ post.user.description }}</p>
                        </div>
                    </div>

                    <!-- Related Posts -->
                    {% if post.related_posts %}
                    <div class="related-posts">
                        <h3 class="section-title">ğŸ“Œ Ù…Ø·Ø§Ù„Ø¨ Ù…Ø±ØªØ¨Ø·</h3>
                        <div class="related-grid" id="relatedPosts">
                            {% for related_post in post.related_posts %}
                            <div class="related-card"><a href="{% url 'post-detail' slug=related_post.slug %}"><img
                                    src="{{ related_post.image.url }}"
                                    alt="{{ related_post.title }}">
                                <div class="body"><span class="post-cat" style="font-size:11px;margin-bottom:6px;">{{ related_post.category.name }}</span>
                                    <h4>{{ related_post.title }}</h4><span class="date">{{ related_post.published_at }}</span>
                                </div>
                            </a></div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Comments -->
                    <div class="comments-section">
                        <h3 class="comment-count">ğŸ’¬ <span id="commentsCountLabel">Ûµ</span> Ù†Ø¸Ø±</h3>
                        <div id="commentsList"></div>

                        <div class="comment-form">
                            <h3>ğŸ’¬ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯</h3>
                            <div class="form-row">
                                <div class="form-group"><label>Ù†Ø§Ù… *</label><input type="text" id="commentName"
                                                                                   placeholder="Ù†Ø§Ù… Ø´Ù…Ø§"></div>
                                <div class="form-group"><label>Ø§ÛŒÙ…ÛŒÙ„ *</label><input type="email" id="commentEmail"
                                                                                     placeholder="Ø§ÛŒÙ…ÛŒÙ„ Ø´Ù…Ø§"></div>
                            </div>
                            <div class="form-group"><label>Ù…ØªÙ† Ù†Ø¸Ø± *</label><textarea id="commentText"
                                                                                      placeholder="Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."></textarea>
                            </div>
                            <div class="checkbox-group" style="margin-bottom:16px;">
                                <input type="checkbox" id="saveInfo">
                                <label for="saveInfo" style="font-size:13px; color:var(--text-light);">Ø°Ø®ÛŒØ±Ù‡ Ù†Ø§Ù… Ùˆ Ø§ÛŒÙ…ÛŒÙ„
                                    Ø¨Ø±Ø§ÛŒ Ø¯ÙØ¹Ø§Øª Ø¨Ø¹Ø¯</label>
                            </div>
                            <button class="btn btn-primary" onclick="submitComment()">Ø§Ø±Ø³Ø§Ù„ Ù†Ø¸Ø±</button>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                {% include 'blog/includes/sidebar.html' %}
            </div>
        </div>
    </section>
{% endblock %}