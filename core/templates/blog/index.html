{% extends 'base.html' %}
{% load static %}
{% load blog_tags %}

{% block content %}

    <!-- Main View -->
    <div id="mainView">
        <!-- Hero -->
        <section class="hero">
            <div class="container">
                {% if search_query %}
                    <h1 id="categoryTitle">ğŸ” Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ: {{ search_query }}</h1>
                    <p>ØªÙ…Ø§Ù… Ù…Ø·Ø§Ù„Ø¨ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</p>

                {% elif category_query %}
                    <h1 id="categoryTitle">ğŸ“‚ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ {{ category_query }}</h1>
                    <p>ØªÙ…Ø§Ù… Ù…Ø·Ø§Ù„Ø¨ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</p>

                {% elif tag_query %}
                    <h1 id="categoryTitle">ğŸ·ï¸ Ø¨Ø±Ú†Ø³Ø¨â€Œ {{ tag_query }}</h1>
                    <p>ØªÙ…Ø§Ù… Ù…Ø·Ø§Ù„Ø¨ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ø§ÛŒÙ† Ø¨Ø±Ú†Ø³Ø¨â€Œ</p>

                {% else %}
                    <h1>ğŸ“ Ø¨Ù‡ Ø¯Ù†ÛŒØ§ÛŒ Ù†ÙˆØ´ØªØ§Ø± Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h1>
                    <p>Ù…Ù‚Ø§Ù„Ø§Øª ØªØ®ØµØµÛŒ Ø¯Ø± Ø­ÙˆØ²Ù‡ ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒØŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ Ùˆ Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ. Ù‡Ø± Ø±ÙˆØ² Ú†ÛŒØ² Ø¬Ø¯ÛŒØ¯ÛŒ ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±ÛŒØ¯.</p>
                    <div class="hero-search">
                        <input type="text" placeholder="Ø¯Ù†Ø¨Ø§Ù„ Ú†Ù‡ Ù…Ø·Ù„Ø¨ÛŒ Ù…ÛŒâ€ŒÚ¯Ø±Ø¯ÛŒØ¯ØŸ" id="heroSearchInput">
                        <button id="heroSearchBtn">Ø¬Ø³ØªØ¬Ùˆ</button>
                    </div>
                {% endif %}
            </div>
        </section>

        {% if not search_query and not category_query and not tag_query %}
            {% featured_posts %}
        {% endif %}

        <!-- Main Content -->
        <section class="main-content">
            <div class="container">
                <div class="content-grid">
                    <!-- Main Posts Area -->
                    <main class="posts-area">
                        {% if category_query %}
                            <h2 class="section-title">ğŸ“„ Ù…Ø·Ø§Ù„Ø¨ Ø¯Ø³ØªÙ‡ Â«{{ category_query }}Â»</h2>
                        {% elif search_query %}
                            <h2 class="section-title">ğŸ“„ Ù…Ø·Ø§Ù„Ø¨ Ø¬Ø³ØªØ¬Ùˆ Â«{{ search_query }}Â»</h2>
                        {% elif tag_query %}
                            <h2 class="section-title">ğŸ“„ Ù…Ø·Ø§Ù„Ø¨ Ø¨Ø±Ú†Ø³Ø¨â€Œ Â«{{ tag_query }}Â»</h2>
                        {% else %}
                            <h2 class="section-title">ğŸ“° Ø¢Ø®Ø±ÛŒÙ† Ù…Ø·Ø§Ù„Ø¨</h2>
                        {% endif %}

                        <div id="postsList">
                            {% if posts %}
                                {% for post in posts %}
                                    <a href="{% url 'post-detail' slug=post.slug %}"
                                       class="post-card post-card-horizontal">
                                        <div class="post-thumb"><img
                                                src="{{ post.image.url }}"
                                                alt="{{ post.title }}"></div>
                                        <div class="post-card-body"><span
                                                class="post-cat">{{ post.category.name }}</span>
                                            <h3>{{ post.title }}</h3>
                                            <p>{{ post.content|truncatechars:100|safe }}</p>
                                            <div class="post-meta"><span class="author"><img
                                                    src="{{ post.user.image.url }}"
                                                    alt="">{{ post.user.full_name }}</span><span>ğŸ“… {{ post.published_at|my_jalalidate }}</span><span>â± {{ post.estimated_reading_time|persian_int }} Ø¯Ù‚ÛŒÙ‚Ù‡</span>
                                            </div>
                                            <div class="post-tags">
                                                {% for tag in post.tags.all %}
                                                    <span class="post-tag">#{{ tag.name }}</span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </a>

                                {% endfor %}

                                <!-- Pagination -->
                                <nav class="pagination" aria-label="ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ">
                                    {% with current=page_obj.number total=page_obj.paginator.num_pages %}

                                        {# Previous #}
                                        {% if page_obj.has_previous %}
                                            <a href="?page=




                                                    {{ page_obj.previous_page_number }}{% if category_query %}&cat={{ category_query }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if tag_query %}&tag={{ tag_query }}{% endif %}"
                                               aria-label="Previous">
                                                Â«
                                            </a>
                                        {% endif %}

                                        {# First page + left dots #}
                                        {% if current > 3 %}
                                            <a href="?page=1{% if category_query %}&cat={{ category_query }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if tag_query %}&tag={{ tag_query }}{% endif %}">1</a>
                                            {% if current > 4 %}
                                                <span>...</span>
                                            {% endif %}
                                        {% endif %}

                                        {# Sliding window around current page #}
                                        {% for i in page_obj.paginator.page_range %}
                                            {% if i >= current|add:"-2" and i <= current|add:"2" %}
                                                {% if i > 0 and i <= total %}
                                                    {% if i == current %}
                                                        <span class="active" aria-current="page">{{ i }}</span>
                                                    {% else %}
                                                        <a href="?page=




                                                                {{ i }}{% if category_query %}&cat={{ category_query }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if tag_query %}&tag={{ tag_query }}{% endif %}">
                                                            {{ i }}
                                                        </a>
                                                    {% endif %}
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}

                                        {# Right dots + last page #}
                                        {% if current < total|add:"-2" %}
                                            {% if current < total|add:"-3" %}
                                                <span>...</span>
                                            {% endif %}
                                            <a href="?page=




                                                    {{ total }}{% if category_query %}&cat={{ category_query }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if tag_query %}&tag={{ tag_query }}{% endif %}">
                                                {{ total }}
                                            </a>
                                        {% endif %}

                                        {# Next #}
                                        {% if page_obj.has_next %}
                                            <a href="?page=




                                                    {{ page_obj.next_page_number }}{% if category_query %}&cat={{ category_query }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if tag_query %}&tag={{ tag_query }}{% endif %}"
                                               aria-label="Next">
                                                Â»
                                            </a>
                                        {% endif %}

                                    {% endwith %}
                                </nav>
                            {% else %}
                                <div style="text-align:center;padding:60px;color:var(--text-light);"><h3>Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª
                                    Ù†Ø´Ø¯ ğŸ˜•</h3>
                                    <p>Ù„Ø·ÙØ§Ù‹ Ø¹Ø¨Ø§Ø±Øª Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯.</p></div>
                            {% endif %}
                        </div>
                    </main>

                    <!-- Sidebar -->
                    {% include 'blog/includes/sidebar.html' %}
                </div>
            </div>
        </section>
    </div>

{% endblock %}